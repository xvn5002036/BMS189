var hair_Colo_new = [];
var status = -1;
var beauty = -1;
var hairCard = [
    5150040,
    5150064,
    5150100,
    5150119,
    5150126,
    5150123,
    5150124,
    5150135,
    5150139,
    5150139
];
var types = -1;
var ct = -1;
var isSecond = false;
var isAngel;

function start() {
    isAngel = cm.getJob() == 6001;
    if (isAngel) {
        cm.sendChoiceAngle();
        return;
    } else {
        action(1, 0, 0);
    }
}

function action(g, f, e) {
    if (g == 0) {
        cm.dispose();
        return;
    } else {
        if (g == 1) {
            status++;
        } else {
            status--;
        }
    }
    switch (status) {
        case 0:
            if (isAngel) {
                isSecond = e != 0;
            }
            cm.askMenu('如果你有#b#t05150040##k，我可以为你设计一个发型。\r\n#r#e#L9#自选发型（推荐）#l#n\r\n#b#L0#随机更换发型 (使用皇家理发券)#l \r\n#b#L1#随机更换发型 (使用顶级皇家理发券)#l\r\n#b#L2#随机更换发型 (使用经典皇家发型)#l\r\n#b#L3#随机更换发型（使用RED皇家理发券）#l\r\n#b#L4#随机更换发型（使用周年庆皇家理发券）#l \r\n#b#L5#随机更换发型（毛莫理发券）#l \r\n#b#L6#随机更换发型（九尾狐理发券）#l\r\n#b#L7#随机更换发型（闪耀之星皇家理发券）#l#l\r\n#b#L8#随机更换发型（奇迹皇家理发券）#l\r\n');
            break;
        case 1:
            beauty = e;
            getHairID(e);
            var a = isSecond ? cm.getPlayer().getSecondHair() : cm.getPlayerStat('HAIR');
            var b = 0;
            var d = [];
            for (var c = 0; c < hair_Colo_new.length; c++) {
                if (hair_Colo_new[c] != a - a % 10) {
                    d[b++] = hair_Colo_new[c] + a % 10;
                }
            }
            hair_Colo_new = cm.filterValidHairs(d);
            if (e == 9) {
                cm.dispose();
                cm.openNpc(1012117, 'BMS新加发型');
            } else {
                cm.askMenu('那么你想...\r\n#b#L0#看看这都有什么发型#l\r\n#b#L1#随机更换发型#l');
            }
            break;
        case 2:
            if (hair_Colo_new.length == 0) {
                cm.dispose();
                cm.sendOk('该理发券正在整理中....');
            } else {
                if (e == 0) {
                    types = 0;
                    cm.askAvatar('那么请随便随便看..', hair_Colo_new, hairCard[beauty]);
                } else {
                    if (e == 1) {
                        types = 1;
                        if (beauty != -1) {
                            cm.askYesNo('您确定要随机更换发型吗？');
                        } else {
                            cm.dispose();
                            cm.sendOk('出现未知错误');
                        }
                    }
                }
            }
            break;
        case 3:
            if (types == 0) {
                if (cm.getPlayer().getCSPoints(1) >= 0) {
                    ct = 1;
                }
                if (cm.getPlayer().getCSPoints(2) >= 0) {
                    ct = 2;
                }
                if (ct != -1) {
                    cm.getPlayer().modifyCSPoints(ct, -0);
                    //cm.gainItem(hairCard[beauty], 1);
                    if (cm.setRandomAvatar(hair_Colo_new) == 1) {
                        cm.addTrait('魅力', 50);
                        cm.dispose();
                        //cm.playerMessage(1, '好了,让朋友们赞叹你的新发型吧!');
                    }
                } else {
                    cm.dispose();
                    cm.playerMessage(1, '点卷或者抵用卷不够!');
                }
            } else {
                if (cm.setRandomAvatar(hair_Colo_new) == 1) {
                    cm.addTrait('魅力', 50);
                    cm.dispose();
                    //cm.playerMessage(1, '好了,让朋友们赞叹你的新发型吧!');
                } else {
                    cm.askYesNo('您没有可使用的会员卡。是否想消耗980抵用券/点卷直接购买使用？');
                }
            }
            break;
        case 4:
            status = 2;
            if (cm.getPlayer().getCSPoints(1) >= 0) {
                ct = 1;
            }
            if (cm.getPlayer().getCSPoints(2) >= 0) {
                ct = 2;
            }
            if (ct != -1) {
                cm.getPlayer().modifyCSPoints(ct, -0);
                //cm.gainItem(hairCard[beauty], 1);
            } else {
                beauty = -1;
            }
            action(g, f, e);
            break;
        default:
            cm.dispose();
            break;
    }
}

function getHairID(a) {
    switch (a) {
        case 0:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    30010,
                    30090,
                    30440,
                    32160,
                    32500,
                    33160,
                    33170,
                    33190,
                    33210,
                    33250,
                    33260,
                    33270,
                    33280,
                    33300,
                    33310,
                    33320,
                    33330,
                    33340,
                    33350,
                    33360
                ];
            } else {
                hair_Colo_new = [
                    31090,
                    31100,
                    31110,
                    31140,
                    31160,
                    31170,
                    31180,
                    31190,
                    31260,
                    31450,
                    31840,
                    31870,
                    31880,
                    31890,
                    31910,
                    31920,
                    31990,
                    32130,
                    32140,
                    32150,
                    32490,
                    34000,
                    34010,
                    34040,
                    34050,
                    34100
                ];
            }
            break;
        case 1:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    33370,
                    33380,
                    33400,
                    33410,
                    33430,
                    33460,
                    33470,
                    33480,
                    33510,
                    33520,
                    33550,
                    33580,
                    33590,
                    33600,
                    33620,
                    33630,
                    40250,
                    33640,
                    33650,
                    33660
                ];
            } else {
                hair_Colo_new = [
                    34110,
                    34120,
                    34130,
                    34140,
                    34150,
                    34160,
                    34170,
                    34180,
                    34190,
                    34200,
                    34210,
                    34220,
                    34230,
                    34240,
                    34250,
                    34260,
                    34270,
                    34280,
                    34290,
                    34310,
                    34320,
                    34330,
                    34340,
                    34360,
                    34370,
                    34380
                ];
            }
            break;
        case 2:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    33370,
                    33380,
                    33400,
                    33410,
                    33430,
                    33460,
                    33470,
                    33480,
                    33510,
                    33520,
                    33550,
                    33580,
                    33590,
                    33600,
                    33620,
                    36700,
                    33630,
                    40250,
                    33640,
                    33650,
                    33660,
                    33670,
                    33680,
                    33700,
                    33710,
                    33720,
                    33730,
                    33740,
                    33750,
                    33760,
                    33770,
                    33780,
                    33790,
                    33800,
                    33810,
                    33820,
                    33930,
                    33940,
                    33950,
                    33960,
                    33970
                ];
            } else {
                hair_Colo_new = [
                    34400,
                    34410,
                    34420,
                    34430,
                    34440,
                    34450,
                    34470,
                    34480,
                    34490,
                    34510,
                    34540,
                    34560,
                    34590,
                    34620,
                    34630,
                    34640,
                    34650,
                    34660,
                    34670,
                    34680,
                    34690,
                    34700,
                    34710,
                    34720,
                    34730,
                    34750
                ];
            }
            break;
        case 3:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    33980,
                    33990,
                    34130,
                    34350,
                    35000,
                    35010,
                    35020,
                    35040,
                    35050,
                    35070,
                    35090,
                    35110,
                    35120,
                    35130,
                    35200,
                    35220,
                    35240,
                    35260,
                    35270,
                    35280
                ];
            } else {
                hair_Colo_new = [
                    34760,
                    34770,
                    34780,
                    34790,
                    34810,
                    34820,
                    34830,
                    34840,
                    34850,
                    34860,
                    34870,
                    34880,
                    34890,
                    34900,
                    34910,
                    34940,
                    34950,
                    34960,
                    34970,
                    34980,
                    34990,
                    35190,
                    35710,
                    36170,
                    36180,
                    36340
                ];
            }
            break;
        case 4:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    35290,
                    35300,
                    35330,
                    35340,
                    35350,
                    35420,
                    35430,
                    35440,
                    35450,
                    35460,
                    35470,
                    35490,
                    35510,
                    35520,
                    35530,
                    35550,
                    35560,
                    35600,
                    35620,
                    35630
                ];
            } else {
                hair_Colo_new = [
                    36350,
                    36400,
                    37000,
                    37010,
                    37020,
                    37030,
                    37040,
                    37050,
                    37060,
                    37090,
                    37100,
                    37110,
                    37180,
                    37190,
                    37200,
                    37210,
                    37220,
                    37230,
                    37270,
                    37280,
                    37290,
                    37300,
                    37310,
                    37320,
                    37340,
                    37350
                ];
            }
            break;
        case 5:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    35650,
                    35660,
                    35680,
                    35690,
                    35710,
                    35720,
                    35760,
                    35770,
                    35780,
                    35790,
                    36000,
                    36030,
                    36080,
                    36090,
                    36100,
                    36110,
                    36130,
                    36140,
                    36150,
                    36160
                ];
            } else {
                hair_Colo_new = [
                    38490,
                    38500,
                    38520,
                    38540,
                    38560,
                    38590,
                    38600,
                    38610,
                    38620,
                    38630,
                    38640,
                    38650,
                    38660,
                    38670,
                    38680,
                    38690,
                    38700,
                    38710,
                    38730,
                    38740,
                    38760,
                    38770,
                    38790,
                    38800,
                    38810,
                    38930,
                    38940,
                    41080,
                    41090,
                    41120,
                    41340
                ];
            }
            break;
        case 6:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    36170,
                    36180,
                    36220,
                    36230,
                    36300,
                    36310,
                    36330,
                    36340,
                    36350,
                    36370,
                    36380,
                    36390,
                    36410,
                    36420,
                    36430,
                    36440,
                    36450,
                    36480,
                    36490,
                    36510
                ];
            } else {
                hair_Colo_new = [
                    37370,
                    37380,
                    37400,
                    37410,
                    37420,
                    37430,
                    37440,
                    37460,
                    37500,
                    37510,
                    37520,
                    37530,
                    37560,
                    37580,
                    37590,
                    37610,
                    37620,
                    37630,
                    37640,
                    37650,
                    37670,
                    37680,
                    37690,
                    37700,
                    37710,
                    37720
                ];
            }
            break;
        case 7:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    36520,
                    36530,
                    36540,
                    36550,
                    36580,
                    36590,
                    36600,
                    36620,
                    36630,
                    36640,
                    36650,
                    36670,
                    36680,
                    36690,
                    36710,
                    36720,
                    36730,
                    36740,
                    36750,
                    36760
                ];
            } else {
                hair_Colo_new = [
                    37730,
                    37740,
                    37750,
                    37760,
                    37800,
                    37810,
                    37820,
                    37830,
                    37840,
                    37850,
                    37860,
                    37880,
                    37890,
                    37900,
                    37910,
                    37920,
                    37930,
                    37940,
                    37950,
                    37960,
                    37970,
                    37980,
                    37990,
                    38010,
                    38020,
                    38040
                ];
            }
            break;
        case 8:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    36770,
                    36800,
                    36810,
                    36820,
                    36830,
                    36840,
                    36850,
                    36860,
                    36880,
                    36890,
                    36900,
                    36910,
                    36920,
                    36930,
                    36940,
                    36950,
                    36980,
                    36990,
                    40000,
                    40020,
                    40030,
                    40040
                ];
            } else {
                hair_Colo_new = [
                    38050,
                    38075,
                    38070,
                    38080,
                    38090,
                    38100,
                    38110,
                    38120,
                    38150,
                    38160,
                    38220,
                    38240,
                    38310,
                    38320,
                    38330,
                    38350,
                    38360,
                    38390,
                    38400,
                    38410,
                    38420,
                    38430,
                    38450,
                    38460,
                    38470,
                    38480
                ];
            }
            break;
        case 9:
            if (cm.getPlayer().getGender() == 0) {
                hair_Colo_new = [
                    40700,
                    40710,
                    40720,
                    40730,
                    40740,
                    40750,
                    40760,
                    40770,
                    40780,
                    40790,
                    40680,
                    36770,
                    36800,
                    36810,
                    36820,
                    36830,
                    36840,
                    36850,
                    36860,
                    36880,
                    36890,
                    36900,
                    36910,
                    36920,
                    36930,
                    36940,
                    36950,
                    36980,
                    36990,
                    40000,
                    40020,
                    40030,
                    40040
                ];
            } else {
                hair_Colo_new = [
                    44020,
                    44030,
                    44040,
                    44050,
                    44060,
                    44070,
                    44080,
                    44090,
                    44100,
                    44110,
                    44120,
                    44130,
                    44140,
                    44150,
                    44160,
                    44170,
                    44180,
                    44190,
                    44200,
                    44290,
                    44300,
                    44310,
                    44320,
                    44330,
                    44340,
                    44350,
                    44360,
                    44370,
                    44380,
                    44390,
                    44400,
                    44410,
                    44420,
                    44430,
                    41910,
                    41920,
                    41930,
                    41940,
                    41950,
                    41960,
                    41970,
                    41980,
                    41990,
                    42010,
                    42060,
                    42070,
                    42090,
                    42110,
                    42120,
                    42090,
                    42080,
                    41840,
                    41830,
                    41820,
                    41810,
                    41770,
                    41760,
                    41750,
                    41740,
                    41730,
                    41720,
                    41700,
                    41690,
                    41680,
                    41670,
                    41660,
                    41650,
                    41640,
                    41600,
                    41590,
                    41580,
                    41570,
                    41560,
                    41550,
                    41540,
                    41520,
                    41510,
                    41490,
                    41480,
                    41470,
                    41460,
                    41440,
                    41430,
                    41420,
                    41410,
                    41400,
                    41390,
                    41380,
                    41370,
                    41360,
                    41350,
                    41340,
                    41220,
                    41210,
                    41200,
                    41190,
                    41160,
                    41150,
                    41070,
                    41080,
                    41060,
                    41377,
                    41390,
                    41440,
                    41460,
                    41470,
                    41420,
                    41430,
                    41220,
                    41340,
                    41600,
                    41650,
                    41660,
                    41640,
                    41690,
                    41680,
                    41670,
                    41660,
                    41720,
                    41710,
                    41700,
                    41490,
                    41470,
                    41480,
                    41520,
                    41510,
                    41555,
                    41560,
                    41540,
                    41585,
                    41593,
                    41570,
                    41580,
                    41576,
                    41870,
                    41860,
                    41880,
                    41900,
                    41890,
                    41916,
                    41930,
                    41920,
                    41950,
                    41940,
                    41936,
                    41980,
                    41970,
                    41730,
                    41740,
                    41750,
                    41760,
                    41770,
                    41800,
                    41810,
                    41820,
                    41830,
                    41840,
                    41850,
                    44140,
                    44130,
                    44150,
                    44110,
                    44100,
                    44120
                ];
            }
            break;
    }
}